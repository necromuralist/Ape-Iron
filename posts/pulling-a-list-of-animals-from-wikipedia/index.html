<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Grabbing a list of animals from wikipedia." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Pulling A List of Animals From Wikipedia | Ape Iron</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Ape-Iron/posts/pulling-a-list-of-animals-from-wikipedia/" rel="canonical"><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script><!--
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/p5.min.js"
</script>

<script type="text/javascript" async
  src="../../../assets/javascript/p5.min.js"
</script>
--><!-- favicons -->
<link href="../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../testing-testing/" rel="prev" title="Testing Testing" type="text/html">
<meta content="Ape Iron" property="og:site_name">
<meta content="Pulling A List of Animals From Wikipedia" property="og:title">
<meta content="https://necromuralist.github.io/Ape-Iron/posts/pulling-a-list-of-animals-from-wikipedia/" property="og:url">
<meta content="Grabbing a list of animals from wikipedia." property="og:description">
<meta content="article" property="og:type">
<meta content="2020-08-03T19:55:10-07:00" property="article:published_time">
<meta content="lists" property="article:tag">
<meta content="scraping" property="article:tag">
<meta content="wikipedia" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../"><span id="blog-title">Ape Iron</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">Cloistered Monkey</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Ape-Iron/"><input name="k8" type="hidden" value="#444444"><input name="k9" type="hidden" value="#D51920"><input name="kt" type="hidden" value="h"><input class="span2" maxlength="255" name="q" placeholder="Search…" type="text"><input style="visibility: hidden;display:none" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Pulling A List of Animals From Wikipedia</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2020-08-03T19:55:10-07:00" itemprop="datePublished" title="2020-08-03 19:55">2020-08-03 19:55</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org29317bb">Beginning</a>
<ul>
<li><a href="#org78efcad">Set Up</a></li>
</ul>
</li>
<li><a href="#org1852711">Middle</a>
<ul>
<li><a href="#orgca5572c">Grabbing Some HTML</a></li>
<li><a href="#orgb5ba555">Building the Table</a></li>
<li><a href="#org54605ff">Cleaning Up the Table</a></li>
<li><a href="#orge3804bd">Meats</a></li>
<li><a href="#org066f420">Again, But With Soup This Time</a></li>
</ul>
</li>
<li><a href="#orga2a51d5">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org29317bb">
<h2 id="org29317bb">Beginning</h2>
<div class="outline-text-2" id="text-org29317bb">
<p>As part of my pursuit of randomness I'm creating lists of things to select from. In this case I want a list of animals to create a <i>Visual Alphabet</i> and I decided to grab one from wikipedia. This is what I did.</p>
</div>
<div class="outline-3" id="outline-container-org78efcad">
<h3 id="org78efcad">Set Up</h3>
<div class="outline-text-3" id="text-org78efcad"></div>
<div class="outline-4" id="outline-container-org36aaf7a">
<h4 id="org36aaf7a">Imports</h4>
<div class="outline-text-4" id="text-org36aaf7a">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">ascii_uppercase</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">be_true</span><span class="p">,</span>
    <span class="n">expect</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">pandas</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org452c61b">
<h4 id="org452c61b">Set Up Tabulate</h4>
<div class="outline-text-4" id="text-org452c61b">
<p>This is just to make printing the pandas data-frames a little easier. <a href="https://github.com/nnicandro/emacs-jupyter">emacs-jupyter</a> actually does a pretty good job of rendering them as HTML like a regular jupyter notebook, but this makes it a little easier to read while still in emacs, plus I can control things better.</p>
<div class="highlight">
<pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgd122afd">
<h4 id="orgd122afd">Set Up Selenium</h4>
<div class="outline-text-4" id="text-orgd122afd">
<p>I started using Requests-HTML because it uses <a href="https://pyppeteer.github.io/pyppeteer/index.html">pyppeteer</a> to render javascript. Unfortunately I can't get it to work in a jupyter notebook. Using <a href="https://github.com/erdewit/nest_asyncio">nest_asyncio</a> allows it to run in the notebook but then I get this error:</p>
<div class="highlight">
<pre><span></span><span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">'coroutine'</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">'newPage'</span>
</pre></div>
<p>And tracking all this down is taking too long so I'm going to switch to using selenium. Since I'm running this on a remote machine we have to run it headless. I used to use <a href="https://www.wikiwand.com/en/Xvfb">XVFB</a> but selenium has a headless mode so let's see if it works.</p>
<div class="highlight">
<pre><span></span><span class="n">options</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">FirefoxOptions</span><span class="p">()</span>
<span class="n">options</span><span class="o">.</span><span class="n">set_headless</span><span class="p">()</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">firefox_options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org1852711">
<h2 id="org1852711">Middle</h2>
<div class="outline-text-2" id="text-org1852711"></div>
<div class="outline-3" id="outline-container-orgca5572c">
<h3 id="orgca5572c">Grabbing Some HTML</h3>
<div class="outline-text-3" id="text-orgca5572c">
<p>Just let selenium render the JQuery tables for us.</p>
<div class="highlight">
<pre><span></span><span class="n">URL</span> <span class="o">=</span> <span class="s2">"https://en.wikipedia.org/wiki/List_of_animal_names"</span>
<span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgb5ba555">
<h3 id="orgb5ba555">Building the Table</h3>
<div class="outline-text-3" id="text-orgb5ba555">
<p>After giving up on Requests-HTML I was using <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/#searching-the-tree">Beautiful Soup</a> to pull out the table so I could give it to pandas, but then I looked at the pandas documentation and it turns out they already do this, so you don't need to, but you do need to know how many tables there are and which one you want (it returns a list of dataframes). In this case I want the last one.</p>
<div class="highlight">
<pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">browser</span><span class="o">.</span><span class="n">page_source</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">('Animal', 'A')</th>
<th class="org-left" scope="col">('Young', 'A')</th>
<th class="org-left" scope="col">('Female', 'A')</th>
<th class="org-left" scope="col">('Male', 'A')</th>
<th class="org-right" scope="col">('Collective noun', 'A')</th>
<th class="org-left" scope="col">('Collateral adjective', 'A')</th>
<th class="org-right" scope="col">('Culinary noun for meat', 'A')</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Aardvark</td>
<td class="org-left">cub</td>
<td class="org-left">sow</td>
<td class="org-left">boar</td>
<td class="org-right">nan</td>
<td class="org-left">orycteropodian</td>
<td class="org-right">nan</td>
</tr>
</tbody>
</table>
<p>That's a little odd looking.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org54605ff">
<h3 id="org54605ff">Cleaning Up the Table</h3>
<div class="outline-text-3" id="text-org54605ff">
<p>First, what's with all the <code>A</code> entries in the header?</p>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
<pre class="example">
MultiIndex([(                'Animal', 'A'),
            (                 'Young', 'A'),
            (                'Female', 'A'),
            (                  'Male', 'A'),
            (       'Collective noun', 'A'),
            (  'Collateral adjective', 'A'),
            ('Culinary noun for meat', 'A')],
           )
</pre>
<p>Hmm..</p>
<div class="highlight">
<pre><span></span><span class="n">table</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
<pre class="example">
Index(['Animal', 'Young', 'Female', 'Male', 'Collective noun',
       'Collateral adjective', 'Culinary noun for meat'],
      dtype='object')
</pre>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Animal</th>
<th class="org-left" scope="col">Young</th>
<th class="org-left" scope="col">Female</th>
<th class="org-left" scope="col">Male</th>
<th class="org-right" scope="col">Collective noun</th>
<th class="org-left" scope="col">Collateral adjective</th>
<th class="org-right" scope="col">Culinary noun for meat</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Aardvark</td>
<td class="org-left">cub</td>
<td class="org-left">sow</td>
<td class="org-left">boar</td>
<td class="org-right">nan</td>
<td class="org-left">orycteropodian</td>
<td class="org-right">nan</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-3" id="outline-container-orge3804bd">
<h3 id="orge3804bd">Meats</h3>
<div class="outline-text-3" id="text-orge3804bd">
<p>At this point I don't know what I really want to do with this. I was originally going to just save the animal names but now the other stuff looks kind of interesting. As an aside I had to look up <a href="https://en.wikipedia.org/wiki/Collateral_adjective">Collateral Adjective</a> on wikipedia:</p>
<blockquote>
<p>A collateral adjective is an adjective that is identified with a particular noun in meaning, but that is not derived from that noun.</p>
</blockquote>
<p>Good to know.</p>
<div class="highlight">
<pre><span></span><span class="n">meats</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">"Culinary noun for meat"</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">meats</span><span class="p">))</span>
</pre></div>
<pre class="example">
49
</pre>
<p>So, now I noticed something else wrong.</p>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">meats</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Animal</th>
<th class="org-left" scope="col">Young</th>
<th class="org-left" scope="col">Female</th>
<th class="org-left" scope="col">Male</th>
<th class="org-left" scope="col">Collective noun</th>
<th class="org-left" scope="col">Collateral adjective</th>
<th class="org-left" scope="col">Culinary noun for meat</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Z</td>
<td class="org-left">Z</td>
<td class="org-left">Z</td>
<td class="org-left">Z</td>
<td class="org-left">Z</td>
<td class="org-left">Z</td>
<td class="org-left">Z</td>
</tr>
</tbody>
</table>
<p>Oops. Maybe I should have looked at the table more closely.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org066f420">
<h3 id="org066f420">Again, But With Soup This Time</h3>
<div class="outline-text-3" id="text-org066f420">
<p>Let's see if using Beautiful Soup will help clean up the dataset a little.</p>
<div class="highlight">
<pre><span></span><span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">browser</span><span class="o">.</span><span class="n">page_source</span><span class="p">)</span>
<span class="n">soup_table</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">"table"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
<p>The <code>read_html</code> method always returns a list, even though I'm only passing in one table.</p>
<div class="highlight">
<pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">soup_table</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">('Animal', 'A')</th>
<th class="org-left" scope="col">('Young', 'A')</th>
<th class="org-left" scope="col">('Female', 'A')</th>
<th class="org-left" scope="col">('Male', 'A')</th>
<th class="org-left" scope="col">('Collective noun', 'A')</th>
<th class="org-left" scope="col">('Collateral adjective', 'A')</th>
<th class="org-right" scope="col">('Culinary noun for meat', 'A')</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Zebra</td>
<td class="org-left">foal colt (male) filly (female)</td>
<td class="org-left">mare</td>
<td class="org-left">stallion</td>
<td class="org-left">herd[11][107] cohort[107]dazzle [108] zeal[11][107]</td>
<td class="org-left">zebrine hippotigrine</td>
<td class="org-right">nan</td>
</tr>
</tbody>
</table>
<p>Actually, that looks worse.</p>
<p>I went back and looked at the page and the table is broken up by sub-headers indicating the first letter of the animal's name.</p>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">soup_table</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)[</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
<pre class="example">
&lt;th colspan="7"&gt;&lt;span id="A"&gt;&lt;/span&gt;&lt;b&gt;A&lt;/b&gt;
</pre>
<p>So, maybe I can clean that up a little before creating the table - here's where Beautiful Soup comes in.</p>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="n">ascii_uppercase</span><span class="p">:</span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">soup_table</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">character</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Element for {character} not found"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">element</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>

<span class="n">soup_table</span><span class="o">.</span><span class="n">smooth</span><span class="p">()</span>
<span class="n">soup_table</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">soup_table</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Animal</th>
<th class="org-left" scope="col">Young</th>
<th class="org-left" scope="col">Female</th>
<th class="org-left" scope="col">Male</th>
<th class="org-right" scope="col">Collective noun</th>
<th class="org-left" scope="col">Collateral adjective</th>
<th class="org-right" scope="col">Culinary noun for meat</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Aardvark</td>
<td class="org-left">cub</td>
<td class="org-left">sow</td>
<td class="org-left">boar</td>
<td class="org-right">nan</td>
<td class="org-left">orycteropodian</td>
<td class="org-right">nan</td>
</tr>
</tbody>
</table>
<p>And now back to the meats.</p>
<div class="highlight">
<pre><span></span><span class="n">meats</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">"Culinary noun for meat"</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">meats</span><span class="p">))</span>
</pre></div>
<pre class="example">
24
</pre>
<div class="highlight">
<pre><span></span><span class="n">meats</span> <span class="o">=</span> <span class="n">meats</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"Culinary noun for meat"</span><span class="p">:</span> <span class="s2">"Meat"</span><span class="p">})</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">meats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"{row.Animal}: {row.Meat}"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Cattle[note 3] (list): beef veal
Chicken (list): poultry
Deer: venison humble (organ meat)
DogfishAlso see Shark: Spiny dogfish capeshark (USA) flake (UK, AUS) huss (UK) kahada (CAN)[50] rigg (UK)rock salmon (UK)
Duck (list) Also see Mallard: poultry
Elk (wapiti): venison
Gaur: garabeef
Goat (list): chevon cabrito mutton
Goose: poultry
Guinea fowl: poultry
Guinea pig: cuy
MallardAlso see Duck: poultry
Moose: venison
Peafowl: poultry
Pig (list) Also see Boar: pork ham bacon
Pigeon (list): squab
RamAlso see Sheep: lamb mutton
Red deer: venison
Shark: flake (AUS)
Sheep (list) Also see Ram: lamb mutton hogget
Snail: escargot
Turkey (list): poultry
Water buffalo: carabeef
Whale: blubber
</pre>
<p>So now there are some other problems - there are footnotes and links that makes things a bit messy. We can't just clear out all link references in the HTML because the names themselves are generally linked so I'll just do some string substitution.</p>
<div class="highlight">
<pre><span></span><span class="n">FOOTNOTES</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"\[\w*\s*\d\]"</span>
<span class="n">FOOTNOTES_2</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"\s"</span> <span class="o">+</span> <span class="n">FOOTNOTES</span>
<span class="n">EMPTY</span> <span class="o">=</span> <span class="s2">""</span>
<span class="n">SPACE</span> <span class="o">=</span> <span class="s2">" "</span>
<span class="n">LIST</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"\(list\)"</span>

<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">FOOTNOTES_2</span><span class="p">,</span> <span class="n">EMPTY</span><span class="p">)</span>
    <span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">FOOTNOTES</span><span class="p">,</span> <span class="n">SPACE</span><span class="p">)</span>
    <span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">LIST</span><span class="p">,</span> <span class="n">EMPTY</span><span class="p">)</span>
<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">32</span><span class="p">:</span><span class="mi">32</span><span class="p">])</span>
</pre></div>
<pre class="example">

      Animal  Young Female  Male                       Collective noun  \
32  Cattle    calf    cow   bull  herd  drove  yoke (oxen) team (oxen)   

                                 Collateral adjective Culinary noun for meat  
32  bovine  taurine (male) vaccine (female) vituli...              beef veal  
</pre>
<div class="highlight">
<pre><span></span><span class="n">meats</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">"Culinary noun for meat"</span><span class="p">])</span>
<span class="n">meats</span> <span class="o">=</span> <span class="n">meats</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"Culinary noun for meat"</span><span class="p">:</span> <span class="s2">"Meat"</span><span class="p">})</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">meats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"{row.Animal}: {row.Meat}"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Cattle  : beef veal
Chicken : poultry
Deer: venison humble (organ meat)
DogfishAlso see Shark: Spiny dogfish capeshark (USA) flake (UK, AUS) huss (UK) kahada (CAN)  rigg (UK)rock salmon (UK)
Duck  Also see Mallard: poultry
Elk (wapiti): venison
Gaur: garabeef
Goat : chevon cabrito mutton
Goose: poultry
Guinea fowl: poultry
Guinea pig: cuy
MallardAlso see Duck: poultry
Moose: venison
Peafowl: poultry
Pig  Also see Boar: pork ham bacon
Pigeon : squab
RamAlso see Sheep: lamb mutton
Red deer: venison
Shark: flake (AUS)
Sheep  Also see Ram: lamb mutton hogget
Snail: escargot
Turkey : poultry
Water buffalo: carabeef
Whale: blubber
</pre>
<p>The weird smashing together of words (e.g. <code>DogfishAlso</code>) appears to happen because wikipedia inserts <code>&lt;br/&gt;</code> tags to create a sub-row within the table rows. Time to try again.</p>
<div class="highlight">
<pre><span></span><span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">browser</span><span class="o">.</span><span class="n">page_source</span><span class="p">)</span>
<span class="n">soup_table</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">"table"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="n">ascii_uppercase</span><span class="p">:</span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">soup_table</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">character</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Element for {character} not found"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">element</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>

<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">soup_table</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">"br"</span><span class="p">):</span>
    <span class="n">tag</span><span class="o">.</span><span class="n">replace_with</span><span class="p">(</span><span class="n">SPACE</span><span class="p">)</span>

<span class="n">soup_table</span><span class="o">.</span><span class="n">smooth</span><span class="p">()</span>
<span class="n">soup_table</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">soup_table</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">table</span><span class="o">.</span><span class="n">Animal</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"Ram"</span><span class="p">)]))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Animal</th>
<th class="org-left" scope="col">Young</th>
<th class="org-left" scope="col">Female</th>
<th class="org-left" scope="col">Male</th>
<th class="org-left" scope="col">Collective noun</th>
<th class="org-left" scope="col">Collateral adjective</th>
<th class="org-left" scope="col">Culinary noun for meat</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Ram Also see Sheep</td>
<td class="org-left">lamb</td>
<td class="org-left">ewe</td>
<td class="org-left">ram</td>
<td class="org-left">flock</td>
<td class="org-left">arietine ovine</td>
<td class="org-left">lamb mutton</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">32</span><span class="p">:</span><span class="mi">32</span><span class="p">])</span>
<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">FOOTNOTES_2</span><span class="p">,</span> <span class="n">EMPTY</span><span class="p">)</span>
    <span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">FOOTNOTES</span><span class="p">,</span> <span class="n">SPACE</span><span class="p">)</span>
    <span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">LIST</span><span class="p">,</span> <span class="n">EMPTY</span><span class="p">)</span>
<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">32</span><span class="p">:</span><span class="mi">32</span><span class="p">])</span>
</pre></div>
<pre class="example">
                   Animal     Young   Female  Male  \
32  Cattle[note 3] (list)  calf[31]  cow[32]  bull   

                               Collective noun  \
32  herd[11] drove[11] yoke (oxen) team (oxen)   

                                 Collateral adjective Culinary noun for meat  
32  bovine[note 4] taurine (male) vaccine (female)...              beef veal  

      Animal  Young Female  Male                       Collective noun  \
32  Cattle    calf    cow   bull  herd  drove  yoke (oxen) team (oxen)   

                                 Collateral adjective Culinary noun for meat  
32  bovine  taurine (male) vaccine (female) vituli...              beef veal  
</pre>
<div class="highlight">
<pre><span></span><span class="n">meats</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">"Culinary noun for meat"</span><span class="p">])</span>
<span class="n">meats</span> <span class="o">=</span> <span class="n">meats</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"Culinary noun for meat"</span><span class="p">:</span> <span class="s2">"Meat"</span><span class="p">})</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">meats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"{row.Animal}: {row.Meat}"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Cattle  : beef veal
Chicken : poultry
Deer: venison humble (organ meat)
Dogfish Also see Shark: Spiny dogfish capeshark (USA) flake (UK, AUS) huss (UK) kahada (CAN)  rigg (UK) rock salmon (UK)
Duck  Also see Mallard: poultry
Elk (wapiti): venison
Gaur: garabeef
Goat : chevon cabrito mutton
Goose: poultry
Guinea fowl: poultry
Guinea pig: cuy
Mallard Also see Duck: poultry
Moose: venison
Peafowl: poultry
Pig  Also see Boar: pork ham bacon
Pigeon : squab
Ram Also see Sheep: lamb mutton
Red deer: venison
Shark: flake (AUS)
Sheep  Also see Ram: lamb mutton hogget
Snail: escargot
Turkey : poultry
Water buffalo: carabeef
Whale: blubber
</pre>
<p>This isn't quite the nice set that I was hoping for, but, oh well. Maybe just one more clean-up and onward.</p>
<div class="highlight">
<pre><span></span><span class="n">PATTERN</span> <span class="o">=</span> <span class="s2">"Also see (?P&lt;name&gt;\w+)"</span>
<span class="k">def</span> <span class="nf">see_also</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">f</span><span class="s2">"(Also see {name})"</span>

<span class="n">table</span><span class="p">[</span><span class="s2">"Animal"</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Animal</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">PATTERN</span><span class="p">,</span> <span class="n">see_also</span><span class="p">)</span>

<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="n">meats</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">"Culinary noun for meat"</span><span class="p">])</span>
<span class="n">meats</span> <span class="o">=</span> <span class="n">meats</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"Culinary noun for meat"</span><span class="p">:</span> <span class="s2">"Meat"</span><span class="p">})</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">meats</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"{row.Animal}: {row.Meat}"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Cattle: beef veal
Chicken: poultry
Deer: venison humble (organ meat)
Dogfish (Also see Shark): Spiny dogfish capeshark (USA) flake (UK, AUS) huss (UK) kahada (CAN)  rigg (UK) rock salmon (UK)
Duck  (Also see Mallard): poultry
Elk (wapiti): venison
Gaur: garabeef
Goat: chevon cabrito mutton
Goose: poultry
Guinea fowl: poultry
Guinea pig: cuy
Mallard (Also see Duck): poultry
Moose: venison
Peafowl: poultry
Pig  (Also see Boar): pork ham bacon
Pigeon: squab
Ram (Also see Sheep): lamb mutton
Red deer: venison
Shark: flake (AUS)
Sheep  (Also see Ram): lamb mutton hogget
Snail: escargot
Turkey: poultry
Water buffalo: carabeef
Whale: blubber
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orga2a51d5">
<h2 id="orga2a51d5">End</h2>
<div class="outline-text-2" id="text-orga2a51d5">
<p>And now to save it for later.</p>
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"WIKIPEDIA"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
    <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"WIKIPEDIA_ANIMALS"</span><span class="p">])</span>
<span class="n">table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
<p>And for an example use.</p>
<div class="highlight">
<pre><span></span><span class="n">animals</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"WIKIPEDIA_ANIMALS"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">())</span>

<span class="k">print</span><span class="p">(</span><span class="n">animals</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
<pre class="example">
Animal                    Marmoset
Young                       infant
Female                           ?
Male                             ?
Collective noun                  ?
Collateral adjective        simian
Culinary noun for meat         NaN
Name: 155, dtype: object
</pre>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">meats</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
<pre class="example">
Animal                                           Dogfish (Also see Shark)
Young                                                                   ?
Female                                                                  ?
Male                                                                    ?
Collective noun                                                     troop
Collateral adjective                                   selachian squaloid
Meat                    Spiny dogfish capeshark (USA) flake (UK, AUS) ...
Name: 59, dtype: object
</pre>
<p>So, there we go. What have we learned?</p>
<ul class="org-ul">
<li>How to pull a page from wikipedia using Selenium</li>
<li>How to find and clean a wikipedia table using Beautiful Soup</li>
<li>How to convert the Beautiful Soup object to a pandas DataFrame</li>
<li>How to further clean up the data frame using string methods and save the table for later as a CSV</li>
</ul>
<p>Not so exciting, but it took longer than I thought it would. I blame the heat - it drives one mental.</p>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../categories/lists/" rel="tag">lists</a></li>
<li><a class="tag p-category" href="../../categories/scraping/" rel="tag">scraping</a></li>
<li><a class="tag p-category" href="../../categories/wikipedia/" rel="tag">wikipedia</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../testing-testing/" rel="prev" title="Testing Testing">Previous post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents © 2020 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script>
</body>
</html>
